<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dabban TV - News Portal</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #0d6efd;
            --secondary: #6c757d;
            --success: #198754;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #0dcaf0;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        
        .navbar-brand {
            font-weight: 800;
            font-size: 1.8rem;
            color: white !important;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .hero-section {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('https://images.unsplash.com/photo-1588681664899-f142ff2dc9b1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0;
            margin-bottom: 40px;
            border-radius: 0 0 20px 20px;
        }
        
        .news-card {
            border: none;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: 100%;
            background: white;
        }
        
        .news-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.15);
        }
        
        .card-img-container {
            height: 220px;
            overflow: hidden;
            background: #f1f3f4;
        }
        
        .card-img-top {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .news-card:hover .card-img-top {
            transform: scale(1.05);
        }
        
        .category-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }
        
        .category-btn {
            border-radius: 25px;
            padding: 8px 20px;
            margin: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
        }
        
        .category-btn.active {
            background: var(--primary) !important;
            color: white !important;
            border-color: var(--primary) !important;
        }
        
        .news-source {
            font-size: 0.85rem;
            color: var(--secondary);
            font-weight: 500;
        }
        
        .news-date {
            font-size: 0.85rem;
            color: var(--secondary);
        }
        
        .loading-container {
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .footer {
            background: #212529;
            color: white;
            margin-top: auto;
            padding: 40px 0 20px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-btn {
            border-radius: 0 5px 5px 0;
        }
        
        /* Auth Modal Styles */
        .auth-modal .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .auth-modal .modal-header {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .auth-modal .modal-body {
            padding: 2rem;
        }
        
        .auth-tabs .nav-link {
            border: none;
            color: var(--secondary);
            font-weight: 500;
            padding: 1rem;
            flex: 1;
            text-align: center;
        }
        
        .auth-tabs .nav-link.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: none;
        }
        
        .auth-form .form-control {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-bottom: 1rem;
        }
        
        .auth-form .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        .auth-btn {
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            margin-top: 1rem;
        }
        
        .divider {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
        }
        
        .divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }
        
        .divider span {
            background: white;
            padding: 0 1rem;
            color: var(--secondary);
        }
        
        .social-login {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-btn {
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .social-btn:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }
        
        .social-btn.google {
            color: #DB4437;
        }
        
        .social-btn.facebook {
            color: #4267B2;
        }
        
        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }
        
        .user-dropdown {
            min-width: 200px;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .user-dropdown .dropdown-item {
            padding: 0.75rem 1rem;
            border-radius: 5px;
            margin: 0.25rem 0.5rem;
            width: calc(100% - 1rem);
        }
        
        .user-dropdown .dropdown-item:hover {
            background: #f8f9fa;
        }
        
        .bookmark-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            transition: all 0.3s;
        }
        
        .bookmark-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .bookmark-btn.bookmarked {
            color: var(--warning);
        }
        
        .user-badge {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .hero-section {
                padding: 60px 0;
            }
            
            .navbar-brand {
                font-size: 1.5rem;
            }
            
            .social-login {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-play-btn-fill me-2"></i>Dabban TV
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active category-nav" href="#" data-category="general">Home</a></li>
                    <li class="nav-item"><a class="nav-link category-nav" href="#" data-category="politics">Politics</a></li>
                    <li class="nav-item"><a class="nav-link category-nav" href="#" data-category="technology">Technology</a></li>
                    <li class="nav-item"><a class="nav-link category-nav" href="#" data-category="business">Business</a></li>
                    <li class="nav-item"><a class="nav-link category-nav" href="#" data-category="sports">Sports</a></li>
                    <li class="nav-item"><a class="nav-link category-nav" href="#" data-category="entertainment">Entertainment</a></li>
                </ul>
                <div class="d-flex search-box align-items-center">
                    <input type="text" class="form-control rounded-0 rounded-start" id="searchInput" placeholder="Search news...">
                    <button class="btn btn-light rounded-0 rounded-end" id="searchBtn">
                        <i class="bi bi-search"></i>
                    </button>
                    
                    <!-- User Menu -->
                    <div class="dropdown ms-3" id="userMenuContainer">
                        <!-- This will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Auth Modals -->
    <div class="modal fade auth-modal" id="authModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs auth-tabs mb-4" id="authTabs">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#loginTab">Login</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#signupTab">Sign Up</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <!-- Login Form -->
                        <div class="tab-pane fade show active" id="loginTab">
                            <form class="auth-form" id="loginForm">
                                <div class="mb-3">
                                    <input type="email" class="form-control" id="loginEmail" placeholder="Email address" required>
                                </div>
                                <div class="mb-3">
                                    <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
                                    <div class="form-text text-end">
                                        <a href="#" class="text-decoration-none" id="forgotPassword">Forgot password?</a>
                                    </div>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="rememberMe">
                                    <label class="form-check-label" for="rememberMe">Remember me</label>
                                </div>
                                <button type="submit" class="btn btn-primary auth-btn">Login</button>
                                
                                <div class="divider">
                                    <span>Or continue with</span>
                                </div>
                                
                                <div class="social-login">
                                    <button type="button" class="social-btn google">
                                        <i class="bi bi-google"></i> Google
                                    </button>
                                    <button type="button" class="social-btn facebook">
                                        <i class="bi bi-facebook"></i> Facebook
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Signup Form -->
                        <div class="tab-pane fade" id="signupTab">
                            <form class="auth-form" id="signupForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control" id="signupFirstName" placeholder="First name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <input type="text" class="form-control" id="signupLastName" placeholder="Last name" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <input type="email" class="form-control" id="signupEmail" placeholder="Email address" required>
                                </div>
                                <div class="mb-3">
                                    <input type="password" class="form-control" id="signupPassword" placeholder="Password" required>
                                </div>
                                <div class="mb-3">
                                    <input type="password" class="form-control" id="signupConfirmPassword" placeholder="Confirm password" required>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="termsAgreement" required>
                                    <label class="form-check-label" for="termsAgreement">
                                        I agree to the <a href="#" class="text-decoration-none">Terms & Conditions</a>
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-success auth-btn">Create Account</button>
                                
                                <div class="divider">
                                    <span>Or sign up with</span>
                                </div>
                                
                                <div class="social-login">
                                    <button type="button" class="social-btn google">
                                        <i class="bi bi-google"></i> Google
                                    </button>
                                    <button type="button" class="social-btn facebook">
                                        <i class="bi bi-facebook"></i> Facebook
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="resetEmail" class="form-label">Enter your email address</label>
                            <input type="email" class="form-control" id="resetEmail" required>
                            <div class="form-text">We'll send you a link to reset your password</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Send Reset Link</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-3">Stay Informed with Dabban TV</h1>
            <p class="lead mb-4">Your trusted source for breaking news and in-depth coverage</p>
            <div class="d-flex flex-wrap justify-content-center gap-3">
                <button class="btn btn-light btn-lg px-4 category-nav" data-category="general">
                    <i class="bi bi-lightning-charge-fill me-2"></i>Top Stories
                </button>
                <button class="btn btn-outline-light btn-lg px-4 category-nav" data-category="technology">
                    <i class="bi bi-cpu me-2"></i>Tech News
                </button>
                <button class="btn btn-outline-light btn-lg px-4 category-nav" data-category="business">
                    <i class="bi bi-graph-up me-2"></i>Business
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container flex-grow-1">
        <!-- Category Filter -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex flex-wrap justify-content-center">
                    <button class="btn btn-outline-primary category-btn category-nav active" data-category="general">General</button>
                    <button class="btn btn-outline-success category-btn category-nav" data-category="business">Business</button>
                    <button class="btn btn-outline-info category-btn category-nav" data-category="technology">Technology</button>
                    <button class="btn btn-outline-warning category-btn category-nav" data-category="entertainment">Entertainment</button>
                    <button class="btn btn-outline-danger category-btn category-nav" data-category="sports">Sports</button>
                    <button class="btn btn-outline-secondary category-btn category-nav" data-category="health">Health</button>
                    <button class="btn btn-outline-dark category-btn category-nav" data-category="science">Science</button>
                </div>
            </div>
        </div>

        <!-- Page Title -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 id="pageTitle" class="fw-bold">Latest News</h2>
                <p id="resultsCount" class="text-muted">Loading latest news...</p>
                <div id="userGreeting" class="alert alert-info d-none" role="alert">
                    Welcome back, <span id="userName"></span>! Here are your personalized news recommendations.
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading-container">
            <div class="text-center">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Fetching latest news articles...</p>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="alert alert-danger d-none" role="alert">
            <h4 class="alert-heading">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>Unable to Load News
            </h4>
            <p id="errorMessage">There was an error loading the news. Please try again later.</p>
            <button id="retryBtn" class="btn btn-danger">
                <i class="bi bi-arrow-clockwise me-2"></i>Retry
            </button>
        </div>

        <!-- News Grid -->
        <div id="newsGrid" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <!-- News cards will be inserted here -->
        </div>

        <!-- No Results -->
        <div id="noResults" class="text-center py-5 d-none">
            <div class="py-5">
                <i class="bi bi-newspaper" style="font-size: 4rem; color: #6c757d;"></i>
                <h3 class="mt-3">No News Found</h3>
                <p class="text-muted">Try a different category or search term</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <h3 class="mb-3">
                        <i class="bi bi-play-btn-fill me-2"></i>Dabban TV
                    </h3>
                    <p class="mb-3">Bringing you the latest news from around the world with accuracy and integrity.</p>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-white"><i class="bi bi-facebook" style="font-size: 1.5rem;"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-twitter" style="font-size: 1.5rem;"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-instagram" style="font-size: 1.5rem;"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-youtube" style="font-size: 1.5rem;"></i></a>
                    </div>
                </div>
                <div class="col-md-6 text-md-end">
                    <h5 class="mb-3">Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white text-decoration-none mb-2 d-inline-block category-nav" data-category="general">Home</a></li>
                        <li><a href="#" class="text-white text-decoration-none mb-2 d-inline-block category-nav" data-category="technology">Technology</a></li>
                        <li><a href="#" class="text-white text-decoration-none mb-2 d-inline-block category-nav" data-category="business">Business</a></li>
                        <li><a href="#" class="text-white text-decoration-none mb-2 d-inline-block category-nav" data-category="sports">Sports</a></li>
                        <li><a href="#" id="footerLogin" class="text-white text-decoration-none mb-2 d-inline-block">Login/Signup</a></li>
                    </ul>
                </div>
            </div>
            <hr class="my-4" style="border-color: rgba(255,255,255,0.1);">
            <div class="text-center">
                <p class="mb-0">&copy; 2025 Dabban TV. All rights reserved.</p>
                <p class="mb-0 text-white-50">Powered by ContextualWeb News API</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ContextualWeb News API Configuration
        const CONTEXTUAL_API_KEY = "8YBFBVEFZNrtufeGTnGuMduS";
        
        // Use the CORRECT endpoint for ContextualWeb API
        const API_CONFIG = {
            baseUrl: 'https://contextualwebsearch-websearch-v1.p.rapidapi.com/api/search/NewsSearchAPI',
            headers: {
                'X-RapidAPI-Key': CONTEXTUAL_API_KEY,
                'X-RapidAPI-Host': 'contextualwebsearch-websearch-v1.p.rapidapi.com'
            },
            params: {
                pageNumber: '1',
                pageSize: '30',
                autoCorrect: 'true',
                safeSearch: 'false'
            }
        };

        // User Authentication System
        class AuthSystem {
            constructor() {
                this.currentUser = null;
                this.users = JSON.parse(localStorage.getItem('dabban_users')) || [];
                this.bookmarks = JSON.parse(localStorage.getItem('dabban_bookmarks')) || {};
                this.init();
            }
            
            init() {
                // Check if user is logged in
                const savedUser = localStorage.getItem('dabban_current_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.updateUserMenu();
                }
            }
            
            // User Registration
            register(userData) {
                // Check if user already exists
                if (this.users.find(u => u.email === userData.email)) {
                    return { success: false, message: 'Email already registered' };
                }
                
                // Create user object
                const newUser = {
                    id: Date.now().toString(),
                    ...userData,
                    createdAt: new Date().toISOString(),
                    bookmarks: [],
                    preferences: {
                        categories: ['general', 'technology'],
                        notifications: true
                    }
                };
                
                // Add to users array
                this.users.push(newUser);
                localStorage.setItem('dabban_users', JSON.stringify(this.users));
                
                // Auto login
                this.login(userData.email, userData.password);
                
                return { success: true, user: newUser };
            }
            
            // User Login
            login(email, password, rememberMe = false) {
                const user = this.users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    this.currentUser = user;
                    localStorage.setItem('dabban_current_user', JSON.stringify(user));
                    
                    if (rememberMe) {
                        localStorage.setItem('dabban_remember_me', 'true');
                    }
                    
                    this.updateUserMenu();
                    return { success: true, user };
                }
                
                return { success: false, message: 'Invalid email or password' };
            }
            
            // User Logout
            logout() {
                this.currentUser = null;
                localStorage.removeItem('dabban_current_user');
                this.updateUserMenu();
                return { success: true };
            }
            
            // Toggle Bookmark
            toggleBookmark(articleId, articleData) {
                if (!this.currentUser) {
                    return { success: false, message: 'Please login to bookmark articles' };
                }
                
                const user = this.currentUser;
                const bookmarkIndex = user.bookmarks.findIndex(b => b.id === articleId);
                
                if (bookmarkIndex === -1) {
                    // Add bookmark
                    user.bookmarks.push({
                        id: articleId,
                        ...articleData,
                        bookmarkedAt: new Date().toISOString()
                    });
                    this.showNotification('Article bookmarked!', 'success');
                } else {
                    // Remove bookmark
                    user.bookmarks.splice(bookmarkIndex, 1);
                    this.showNotification('Bookmark removed', 'info');
                }
                
                // Update user in storage
                const userIndex = this.users.findIndex(u => u.id === user.id);
                if (userIndex !== -1) {
                    this.users[userIndex] = user;
                    localStorage.setItem('dabban_users', JSON.stringify(this.users));
                    localStorage.setItem('dabban_current_user', JSON.stringify(user));
                    this.currentUser = user;
                }
                
                return { success: true, bookmarked: bookmarkIndex === -1 };
            }
            
            // Check if article is bookmarked
            isBookmarked(articleId) {
                if (!this.currentUser) return false;
                return this.currentUser.bookmarks.some(b => b.id === articleId);
            }
            
            // Get user's bookmarks
            getBookmarks() {
                return this.currentUser ? this.currentUser.bookmarks : [];
            }
            
            // Update user menu
            updateUserMenu() {
                const container = document.getElementById('userMenuContainer');
                
                if (this.currentUser) {
                    // User is logged in
                    const firstName = this.currentUser.firstName;
                    const firstLetter = firstName ? firstName.charAt(0).toUpperCase() : 'U';
                    
                    container.innerHTML = `
                        <div class="dropdown">
                            <button class="user-avatar dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                ${firstLetter}
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end user-dropdown">
                                <li>
                                    <div class="px-3 py-2">
                                        <strong>${this.currentUser.firstName} ${this.currentUser.lastName}</strong>
                                        <div class="text-muted small">${this.currentUser.email}</div>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="#" id="viewBookmarks">
                                        <i class="bi bi-bookmark me-2"></i>My Bookmarks
                                        <span class="badge bg-primary rounded-pill ms-2">${this.currentUser.bookmarks.length}</span>
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#" id="viewProfile">
                                        <i class="bi bi-person me-2"></i>My Profile
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="#" id="settings">
                                        <i class="bi bi-gear me-2"></i>Settings
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="#" id="logoutBtn">
                                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                                    </a>
                                </li>
                            </ul>
                        </div>
                    `;
                    
                    // Update greeting
                    document.getElementById('userGreeting').classList.remove('d-none');
                    document.getElementById('userName').textContent = this.currentUser.firstName;
                    
                    // Add event listeners
                    document.getElementById('logoutBtn').addEventListener('click', (e) => {
                        e.preventDefault();
                        this.logout();
                        this.showNotification('Logged out successfully', 'info');
                    });
                    
                    document.getElementById('viewBookmarks').addEventListener('click', (e) => {
                        e.preventDefault();
                        showBookmarks();
                    });
                    
                } else {
                    // User is not logged in
                    container.innerHTML = `
                        <button class="btn btn-outline-light" id="loginBtn">
                            <i class="bi bi-person me-2"></i>Login / Signup
                        </button>
                    `;
                    
                    // Hide greeting
                    document.getElementById('userGreeting').classList.add('d-none');
                    
                    // Add event listener
                    document.getElementById('loginBtn').addEventListener('click', (e) => {
                        e.preventDefault();
                        const authModal = new bootstrap.Modal(document.getElementById('authModal'));
                        authModal.show();
                    });
                }
            }
            
            // Show notification
            showNotification(message, type = 'info') {
                // Remove existing notifications
                const existing = document.querySelector('.notification-toast');
                if (existing) existing.remove();
                
                // Create new notification
                const toast = document.createElement('div');
                toast.className = `notification-toast position-fixed top-0 end-0 m-3 p-3 rounded shadow bg-${type} text-white`;
                toast.style.zIndex = '9999';
                toast.style.minWidth = '300px';
                toast.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi ${type === 'success' ? 'bi-check-circle' : 'bi-info-circle'} me-2"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white" onclick="this.parentElement.parentElement.remove()"></button>
                    </div>
                `;
                
                document.body.appendChild(toast);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 3000);
            }
        }

        // DOM Elements
        const newsGrid = document.getElementById('newsGrid');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const noResults = document.getElementById('noResults');
        const pageTitle = document.getElementById('pageTitle');
        const resultsCount = document.getElementById('resultsCount');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const retryBtn = document.getElementById('retryBtn');
        
        // Initialize auth system
        const auth = new AuthSystem();
        
        // State management
        let currentCategory = 'general';
        let currentSearch = '';
        let isLoading = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial news
            loadNews('general', 'Latest News');
            
            // Setup category navigation
            document.querySelectorAll('.category-nav').forEach(nav => {
                nav.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.getAttribute('data-category');
                    const categoryName = this.textContent.trim();
                    
                    // Update active states
                    document.querySelectorAll('.category-nav').forEach(n => n.classList.remove('active'));
                    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Load news for category
                    currentCategory = category;
                    currentSearch = '';
                    searchInput.value = '';
                    loadNews(category, getCategoryDisplayName(category));
                });
            });
            
            // Setup search
            searchBtn.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            
            // Setup retry button
            retryBtn.addEventListener('click', function() {
                if (currentSearch) {
                    loadSearchResults(currentSearch);
                } else {
                    loadNews(currentCategory, getCategoryDisplayName(currentCategory));
                }
            });
            
            // Setup auth forms
            setupAuthForms();
            
            // Setup footer login link
            document.getElementById('footerLogin').addEventListener('click', function(e) {
                e.preventDefault();
                const authModal = new bootstrap.Modal(document.getElementById('authModal'));
                authModal.show();
            });
            
            // Setup forgot password
            document.getElementById('forgotPassword').addEventListener('click', function(e) {
                e.preventDefault();
                const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                authModal.hide();
                
                setTimeout(() => {
                    const forgotModal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));
                    forgotModal.show();
                }, 300);
            });
        });

        // Setup authentication forms
        function setupAuthForms() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const rememberMe = document.getElementById('rememberMe').checked;
                
                const result = auth.login(email, password, rememberMe);
                
                if (result.success) {
                    auth.showNotification('Login successful!', 'success');
                    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                    authModal.hide();
                    
                    // Clear form
                    this.reset();
                    
                    // Reload news with user preferences
                    if (auth.currentUser && auth.currentUser.preferences) {
                        loadNews(auth.currentUser.preferences.categories[0], 
                                getCategoryDisplayName(auth.currentUser.preferences.categories[0]));
                    }
                } else {
                    auth.showNotification(result.message, 'danger');
                }
            });
            
            // Signup form
            document.getElementById('signupForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const firstName = document.getElementById('signupFirstName').value;
                const lastName = document.getElementById('signupLastName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                
                // Validation
                if (password !== confirmPassword) {
                    auth.showNotification('Passwords do not match', 'danger');
                    return;
                }
                
                if (password.length < 6) {
                    auth.showNotification('Password must be at least 6 characters', 'danger');
                    return;
                }
                
                const userData = {
                    firstName,
                    lastName,
                    email,
                    password
                };
                
                const result = auth.register(userData);
                
                if (result.success) {
                    auth.showNotification('Account created successfully!', 'success');
                    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
                    authModal.hide();
                    
                    // Clear form
                    this.reset();
                } else {
                    auth.showNotification(result.message, 'danger');
                }
            });
            
            // Forgot password form
            document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('resetEmail').value;
                
                // In a real app, you would send this to your backend
                auth.showNotification(`Password reset link sent to ${email}`, 'info');
                
                const forgotModal = bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal'));
                forgotModal.hide();
                this.reset();
            });
            
            // Social login buttons
            document.querySelectorAll('.social-btn.google').forEach(btn => {
                btn.addEventListener('click', function() {
                    auth.showNotification('Google login would be implemented in production', 'info');
                });
            });
            
            document.querySelectorAll('.social-btn.facebook').forEach(btn => {
                btn.addEventListener('click', function() {
                    auth.showNotification('Facebook login would be implemented in production', 'info');
                });
            });
        }

        // Show bookmarks
        function showBookmarks() {
            const bookmarks = auth.getBookmarks();
            
            if (bookmarks.length === 0) {
                pageTitle.textContent = 'My Bookmarks';
                resultsCount.textContent = 'No bookmarked articles yet';
                clearNewsGrid();
                showNoResults();
                return;
            }
            
            pageTitle.textContent = 'My Bookmarks';
            resultsCount.textContent = `${bookmarks.length} bookmarked articles`;
            displayNewsArticles(bookmarks);
        }

        // Load news from ContextualWeb API
        async function loadNews(category, displayName) {
            try {
                if (isLoading) return;
                
                isLoading = true;
                showLoading();
                hideError();
                hideNoResults();
                clearNewsGrid();
                
                // Update UI
                pageTitle.textContent = displayName;
                resultsCount.textContent = 'Loading news...';
                
                // Build API parameters based on category
                let query = getCategoryQuery(category);
                let url = buildApiUrl(query);
                
                console.log('Fetching from URL:', url);
                
                // Use mock data for now (since API might have issues)
                // Comment this out and uncomment the fetch code below when API is working
                useMockData(category, displayName);
                return;
                
                /*
                // Uncomment this when API is working
                const response = await fetch(url, {
                    method: 'GET',
                    headers: API_CONFIG.headers
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Check if we have valid data
                if (data && data.value && Array.isArray(data.value)) {
                    displayNewsArticles(data.value);
                    resultsCount.textContent = `Found ${data.value.length} news articles`;
                } else {
                    throw new Error('Invalid response format from API');
                }
                */
                
            } catch (error) {
                console.error('Error loading news:', error);
                useMockData(category, displayName); // Fallback to mock data
            } finally {
                isLoading = false;
                hideLoading();
            }
        }

        // Use mock data (temporary solution)
        function useMockData(category, displayName) {
            const mockArticles = {
                general: [
                    {
                        id: '1',
                        title: "Global Leaders Gather for Climate Summit",
                        description: "World leaders meet to discuss urgent climate action and sustainability goals for the coming decade.",
                        url: "#",
                        image: { url: "https://images.unsplash.com/photo-1589652717521-10c0d092dea9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                        provider: { name: "Global News" },
                        datePublished: new Date().toISOString()
                    },
                    {
                        id: '2',
                        title: "Tech Giants Announce AI Partnership",
                        description: "Major technology companies join forces to develop ethical AI standards and innovations.",
                        url: "#",
                        image: { url: "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                        provider: { name: "Tech Times" },
                        datePublished: new Date().toISOString()
                    },
                    {
                        id: '3',
                        title: "Stock Markets Reach Record High",
                        description: "Global markets surge as economic indicators show strong recovery post-pandemic.",
                        url: "#",
                        image: { url: "https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                        provider: { name: "Business Daily" },
                        datePublished: new Date().toISOString()
                    }
                ],
                technology: [
                    {
                        id: '4',
                        title: "Quantum Computing Breakthrough Announced",
                        description: "Researchers achieve major milestone in quantum computing stability and processing power.",
                        url: "#",
                        image: { url: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                        provider: { name: "Science Tech" },
                        datePublished: new Date().toISOString()
                    },
                    {
                        id: '5',
                        title: "New Smartphone Features Revolutionary Camera",
                        description: "Latest smartphone release includes AI-powered camera with unprecedented low-light capabilities.",
                        url: "#",
                        image: { url: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                        provider: { name: "Mobile World" },
                        datePublished: new Date().toISOString()
                    }
                ],
                business: [
                    {
                        id: '6',
                        title: "Startup Valuation Soars After Funding Round",
                        description: "Tech startup secures $100M in Series B funding, valuation reaches $1B.",
                        url: "#",
                        image: { url: "https://images.unsplash.com/photo-1556761175-b413da4baf72?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                        provider: { name: "Venture News" },
                        datePublished: new Date().toISOString()
                    }
                ]
            };
            
            const articles = mockArticles[category] || mockArticles.general;
            displayNewsArticles(articles);
            resultsCount.textContent = `Showing ${articles.length} news articles`;
        }

        // Build API URL
        function buildApiUrl(query) {
            const params = new URLSearchParams({
                ...API_CONFIG.params,
                q: query
            });
            
            return `${API_CONFIG.baseUrl}?${params.toString()}`;
        }

        // Get query based on category
        function getCategoryQuery(category) {
            const queries = {
                'general': 'news',
                'politics': 'politics news',
                'technology': 'technology news',
                'business': 'business news',
                'sports': 'sports news',
                'entertainment': 'entertainment news',
                'health': 'health news',
                'science': 'science news'
            };
            
            return queries[category] || 'news';
        }

        // Get display name for category
        function getCategoryDisplayName(category) {
            const names = {
                'general': 'Latest News',
                'politics': 'Politics News',
                'technology': 'Technology News',
                'business': 'Business News',
                'sports': 'Sports News',
                'entertainment': 'Entertainment News',
                'health': 'Health News',
                'science': 'Science News'
            };
            
            return names[category] || 'News';
        }

        // Display news articles
        function displayNewsArticles(articles) {
            clearNewsGrid();
            
            if (!articles || articles.length === 0) {
                showNoResults();
                return;
            }
            
            articles.forEach(article => {
                const newsCard = createNewsCard(article);
                newsGrid.appendChild(newsCard);
            });
        }

        // Create a news card element
        function createNewsCard(article) {
            const col = document.createElement('div');
            col.className = 'col';
            
            // Generate unique ID if not present
            const articleId = article.id || `article_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            
            // Format date
            const publishedDate = article.datePublished ? 
                new Date(article.datePublished).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }) : 'Recent';
            
            // Get image URL
            const imageUrl = article.image?.url || article.urlToImage || 
                           'https://images.unsplash.com/photo-1588681664899-f142ff2dc9b1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80';
            
            // Check if bookmarked
            const isBookmarked = auth.isBookmarked(articleId);
            
            col.innerHTML = `
                <div class="card news-card h-100">
                    <div class="card-img-container position-relative">
                        <img src="${imageUrl}" 
                             class="card-img-top" 
                             alt="${article.title}"
                             onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1588681664899-f142ff2dc9b1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">
                        <button class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" 
                                data-article-id="${articleId}">
                            <i class="bi ${isBookmarked ? 'bi-bookmark-fill' : 'bi-bookmark'}"></i>
                        </button>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold">${article.title || 'No Title Available'}</h5>
                        <p class="card-text flex-grow-1">${article.description || 'No description available.'}</p>
                        <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="news-source">
                                    <i class="bi bi-newspaper me-1"></i>
                                    ${article.provider?.name || article.source?.name || 'Unknown Source'}
                                </span>
                                <span class="news-date">
                                    <i class="bi bi-calendar me-1"></i>
                                    ${publishedDate}
                                </span>
                            </div>
                            <a href="${article.url || '#'}" 
                               target="_blank" 
                               class="btn btn-primary w-100">
                                <i class="bi bi-arrow-right-circle me-2"></i>Read Full Story
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            // Add bookmark functionality
            const bookmarkBtn = col.querySelector('.bookmark-btn');
            bookmarkBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const result = auth.toggleBookmark(articleId, {
                    title: article.title,
                    description: article.description,
                    url: article.url,
                    image: article.image,
                    provider: article.provider,
                    datePublished: article.datePublished
                });
                
                if (result.success) {
                    const icon = this.querySelector('i');
                    if (result.bookmarked) {
                        this.classList.add('bookmarked');
                        icon.className = 'bi bi-bookmark-fill';
                    } else {
                        this.classList.remove('bookmarked');
                        icon.className = 'bi bi-bookmark';
                    }
                }
            });
            
            return col;
        }

        // Handle search
        function handleSearch() {
            const searchTerm = searchInput.value.trim();
            
            if (searchTerm) {
                currentSearch = searchTerm;
                loadSearchResults(searchTerm);
            } else {
                // If search is empty, revert to current category
                currentSearch = '';
                loadNews(currentCategory, getCategoryDisplayName(currentCategory));
            }
        }

        // Load search results
        async function loadSearchResults(query) {
            try {
                isLoading = true;
                showLoading();
                hideError();
                hideNoResults();
                clearNewsGrid();
                
                pageTitle.textContent = `Search: "${query}"`;
                resultsCount.textContent = 'Searching...';
                
                // Use mock data for search
                setTimeout(() => {
                    const mockSearchResults = [
                        {
                            id: 'search_1',
                            title: `Results for "${query}" in Technology`,
                            description: `Latest news and developments related to ${query} in the technology sector.`,
                            url: "#",
                            image: { url: "https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                            provider: { name: "Search Results" },
                            datePublished: new Date().toISOString()
                        },
                        {
                            id: 'search_2',
                            title: `${query} Trends in Business`,
                            description: `How ${query} is impacting business strategies and market dynamics globally.`,
                            url: "#",
                            image: { url: "https://images.unsplash.com/photo-1556761175-b413da4baf72?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
                            provider: { name: "Business Insights" },
                            datePublished: new Date().toISOString()
                        }
                    ];
                    
                    displayNewsArticles(mockSearchResults);
                    resultsCount.textContent = `Found ${mockSearchResults.length} results for "${query}"`;
                    hideLoading();
                }, 1000);
                
            } catch (error) {
                console.error('Search error:', error);
                showError('Search failed. Please try again.');
                resultsCount.textContent = 'Search error';
                hideLoading();
            }
        }

        // UI Helper Functions
        function showLoading() {
            loadingState.style.display = 'flex';
        }

        function hideLoading() {
            loadingState.style.display = 'none';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorState.classList.remove('d-none');
        }

        function hideError() {
            errorState.classList.add('d-none');
        }

        function showNoResults() {
            noResults.classList.remove('d-none');
        }

        function hideNoResults() {
            noResults.classList.add('d-none');
        }

        function clearNewsGrid() {
            newsGrid.innerHTML = '';
        }
    </script>
</body>
</html>
